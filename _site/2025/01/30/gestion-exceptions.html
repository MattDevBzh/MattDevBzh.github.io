<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Gestion des exceptions en C# : G√©rer les pannes de votre caf√© avec √©l√©gance | Le dev, c‚Äôest di√®se</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Gestion des exceptions en C# : G√©rer les pannes de votre caf√© avec √©l√©gance" />
<meta name="author" content="MattDevBzh" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Dans un caf√©, tout ne se passe pas toujours comme pr√©vu ! Machine en panne, stock √©puis√©, commande incorrecte‚Ä¶ En programmation C#, les exceptions nous permettent de g√©rer ces situations inattendues avec √©l√©gance et professionnalisme. ‚òï" />
<meta property="og:description" content="Dans un caf√©, tout ne se passe pas toujours comme pr√©vu ! Machine en panne, stock √©puis√©, commande incorrecte‚Ä¶ En programmation C#, les exceptions nous permettent de g√©rer ces situations inattendues avec √©l√©gance et professionnalisme. ‚òï" />
<link rel="canonical" href="http://0.0.0.0:4000/2025/01/30/gestion-exceptions.html" />
<meta property="og:url" content="http://0.0.0.0:4000/2025/01/30/gestion-exceptions.html" />
<meta property="og:site_name" content="Le dev, c‚Äôest di√®se" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2025-01-30T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gestion des exceptions en C# : G√©rer les pannes de votre caf√© avec √©l√©gance" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"MattDevBzh"},"dateModified":"2025-01-30T00:00:00+00:00","datePublished":"2025-01-30T00:00:00+00:00","description":"Dans un caf√©, tout ne se passe pas toujours comme pr√©vu ! Machine en panne, stock √©puis√©, commande incorrecte‚Ä¶ En programmation C#, les exceptions nous permettent de g√©rer ces situations inattendues avec √©l√©gance et professionnalisme. ‚òï","headline":"Gestion des exceptions en C# : G√©rer les pannes de votre caf√© avec √©l√©gance","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2025/01/30/gestion-exceptions.html"},"url":"http://0.0.0.0:4000/2025/01/30/gestion-exceptions.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="Le dev, c&apos;est di√®se" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Le dev, c&#39;est di√®se</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/">Bienvenue sur mon blog tech</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Gestion des exceptions en C# : G√©rer les pannes de votre caf√© avec √©l√©gance</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2025-01-30T00:00:00+00:00" itemprop="datePublished">Jan 30, 2025
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Dans un caf√©, tout ne se passe pas toujours comme pr√©vu ! <strong>Machine en panne, stock √©puis√©, commande incorrecte‚Ä¶</strong> En programmation C#, les <strong>exceptions</strong> nous permettent de g√©rer ces situations inattendues avec √©l√©gance et professionnalisme. ‚òï</p>

<p>D√©couvrons ensemble comment transformer les probl√®mes en solutions gr√¢ce √† la gestion d‚Äôexceptions !</p>

<h2 id="sommaire">Sommaire</h2>
<ul id="markdown-toc">
  <li><a href="#sommaire" id="markdown-toc-sommaire">Sommaire</a></li>
  <li><a href="#quest-ce-quune-exception-" id="markdown-toc-quest-ce-quune-exception-">Qu‚Äôest-ce qu‚Äôune exception ?</a></li>
  <li><a href="#1-la-structure-trycatch--attraper-les-erreurs" id="markdown-toc-1-la-structure-trycatch--attraper-les-erreurs">1. La structure <code class="language-plaintext highlighter-rouge">try...catch</code> : Attraper les erreurs</a>    <ul>
      <li><a href="#syntaxe-de-base" id="markdown-toc-syntaxe-de-base">Syntaxe de base</a></li>
      <li><a href="#exemple--division-par-z√©ro-dans-le-calcul-de-prix" id="markdown-toc-exemple--division-par-z√©ro-dans-le-calcul-de-prix">Exemple : Division par z√©ro dans le calcul de prix</a></li>
      <li><a href="#exemple--acc√®s-√†-un-index-inexistant" id="markdown-toc-exemple--acc√®s-√†-un-index-inexistant">Exemple : Acc√®s √† un index inexistant</a></li>
    </ul>
  </li>
  <li><a href="#2-plusieurs-types-dexceptions--catch-multiples" id="markdown-toc-2-plusieurs-types-dexceptions--catch-multiples">2. Plusieurs types d‚Äôexceptions : <code class="language-plaintext highlighter-rouge">catch</code> multiples</a>    <ul>
      <li><a href="#exemple--gestion-compl√®te-dune-commande" id="markdown-toc-exemple--gestion-compl√®te-dune-commande">Exemple : Gestion compl√®te d‚Äôune commande</a></li>
    </ul>
  </li>
  <li><a href="#3-le-bloc-finally--nettoyage-garanti" id="markdown-toc-3-le-bloc-finally--nettoyage-garanti">3. Le bloc <code class="language-plaintext highlighter-rouge">finally</code> : Nettoyage garanti</a>    <ul>
      <li><a href="#exemple--gestion-dune-machine-√†-caf√©" id="markdown-toc-exemple--gestion-dune-machine-√†-caf√©">Exemple : Gestion d‚Äôune machine √† caf√©</a></li>
    </ul>
  </li>
  <li><a href="#4-cr√©er-des-exceptions-personnalis√©es" id="markdown-toc-4-cr√©er-des-exceptions-personnalis√©es">4. Cr√©er des exceptions personnalis√©es</a>    <ul>
      <li><a href="#exemple--exceptions-m√©tier-pour-un-caf√©" id="markdown-toc-exemple--exceptions-m√©tier-pour-un-caf√©">Exemple : Exceptions m√©tier pour un caf√©</a></li>
    </ul>
  </li>
  <li><a href="#5-validation-et-exceptions-pr√©ventives" id="markdown-toc-5-validation-et-exceptions-pr√©ventives">5. Validation et exceptions pr√©ventives</a>    <ul>
      <li><a href="#exemple--validation-robuste-de-commande" id="markdown-toc-exemple--validation-robuste-de-commande">Exemple : Validation robuste de commande</a></li>
    </ul>
  </li>
  <li><a href="#6-logging-et-tra√ßabilit√©-des-erreurs" id="markdown-toc-6-logging-et-tra√ßabilit√©-des-erreurs">6. Logging et tra√ßabilit√© des erreurs</a>    <ul>
      <li><a href="#exemple--syst√®me-de-logs-derreurs" id="markdown-toc-exemple--syst√®me-de-logs-derreurs">Exemple : Syst√®me de logs d‚Äôerreurs</a></li>
    </ul>
  </li>
  <li><a href="#7-exemple-complet--syst√®me-robuste-de-caf√©" id="markdown-toc-7-exemple-complet--syst√®me-robuste-de-caf√©">7. Exemple complet : Syst√®me robuste de caf√©</a></li>
  <li><a href="#8-bonnes-pratiques-de-gestion-dexceptions" id="markdown-toc-8-bonnes-pratiques-de-gestion-dexceptions">8. Bonnes pratiques de gestion d‚Äôexceptions</a>    <ul>
      <li><a href="#-exceptions-sp√©cifiques" id="markdown-toc--exceptions-sp√©cifiques">‚úÖ Exceptions sp√©cifiques</a></li>
      <li><a href="#-messages-derreur-utiles" id="markdown-toc--messages-derreur-utiles">‚úÖ Messages d‚Äôerreur utiles</a></li>
      <li><a href="#-logging-appropri√©" id="markdown-toc--logging-appropri√©">‚úÖ Logging appropri√©</a></li>
      <li><a href="#-nettoyage-avec-finally-ou-using" id="markdown-toc--nettoyage-avec-finally-ou-using">‚úÖ Nettoyage avec <code class="language-plaintext highlighter-rouge">finally</code> ou <code class="language-plaintext highlighter-rouge">using</code></a></li>
    </ul>
  </li>
  <li><a href="#exercices-pratiques" id="markdown-toc-exercices-pratiques">Exercices pratiques</a>    <ul>
      <li><a href="#exercice-1--calculatrice-robuste" id="markdown-toc-exercice-1--calculatrice-robuste">Exercice 1 : Calculatrice robuste</a></li>
      <li><a href="#exercice-2--lecteur-de-fichier-s√©curis√©" id="markdown-toc-exercice-2--lecteur-de-fichier-s√©curis√©">Exercice 2 : Lecteur de fichier s√©curis√©</a></li>
      <li><a href="#exercice-3--api-de-caf√©-resiliente" id="markdown-toc-exercice-3--api-de-caf√©-resiliente">Exercice 3 : API de caf√© resiliente</a></li>
    </ul>
  </li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

<hr />

<h2 id="quest-ce-quune-exception-">Qu‚Äôest-ce qu‚Äôune exception ?</h2>

<p>Une <strong>exception</strong> est un √©v√©nement inattendu qui interrompt le cours normal d‚Äôun programme. C‚Äôest comme :</p>

<ul>
  <li>‚ö° <strong>Panne de courant</strong> pendant la pr√©paration d‚Äôun caf√©</li>
  <li>üì¶ <strong>Stock vide</strong> alors qu‚Äôun client commande</li>
  <li>üîß <strong>Machine en maintenance</strong> non signal√©e</li>
  <li>üí≥ <strong>Carte bancaire refus√©e</strong> au moment du paiement</li>
</ul>

<p>Sans gestion appropri√©e, ces probl√®mes peuvent faire ‚Äúplanter‚Äù votre programme !</p>

<hr />

<h2 id="1-la-structure-trycatch--attraper-les-erreurs">1. La structure <code class="language-plaintext highlighter-rouge">try...catch</code> : Attraper les erreurs</h2>

<p>La structure <code class="language-plaintext highlighter-rouge">try...catch</code> permet d‚Äôessayer une op√©ration et de g√©rer les erreurs qui peuvent survenir.</p>

<h3 id="syntaxe-de-base">Syntaxe de base</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span>
<span class="p">{</span>
    <span class="c1">// Code qui peut g√©n√©rer une exception</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">TypeException</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Gestion de l'erreur</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="exemple--division-par-z√©ro-dans-le-calcul-de-prix">Exemple : Division par z√©ro dans le calcul de prix</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">double</span> <span class="nf">calculerPrixUnitaire</span><span class="p">(</span><span class="kt">double</span> <span class="n">prixTotal</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">prixUnitaire</span> <span class="p">=</span> <span class="n">prixTotal</span> <span class="p">/</span> <span class="n">quantite</span><span class="p">;</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Prix unitaire : </span><span class="p">{</span><span class="n">prixUnitaire</span><span class="p">:</span><span class="n">C2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">prixUnitaire</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">DivideByZeroException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"‚ùå Erreur : Impossible de diviser par z√©ro !"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"V√©rifiez que la quantit√© est sup√©rieure √† 0."</span><span class="p">);</span>
        <span class="k">return</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Test</span>
<span class="nf">calculerPrixUnitaire</span><span class="p">(</span><span class="m">15.50</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span> <span class="c1">// Va d√©clencher l'exception</span>
<span class="nf">calculerPrixUnitaire</span><span class="p">(</span><span class="m">15.50</span><span class="p">,</span> <span class="m">3</span><span class="p">);</span> <span class="c1">// Fonctionne normalement</span>
</code></pre></div></div>

<h3 id="exemple--acc√®s-√†-un-index-inexistant">Exemple : Acc√®s √† un index inexistant</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">string</span><span class="p">[]</span> <span class="n">menuCafes</span> <span class="p">=</span> <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="s">"Cappuccino"</span><span class="p">,</span> <span class="s">"Latte"</span><span class="p">};</span>

<span class="k">void</span> <span class="nf">afficherCafe</span><span class="p">(</span><span class="kt">int</span> <span class="n">index</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Caf√© s√©lectionn√© : </span><span class="p">{</span><span class="n">menuCafes</span><span class="p">[</span><span class="n">index</span><span class="p">]}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">IndexOutOfRangeException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur : Index </span><span class="p">{</span><span class="n">index</span><span class="p">}</span><span class="s"> n'existe pas !"</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Indices valides : 0 √† </span><span class="p">{</span><span class="n">menuCafes</span><span class="p">.</span><span class="n">Length</span> <span class="p">-</span> <span class="m">1</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        
        <span class="c1">// Afficher le menu complet</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Menu disponible :"</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">menuCafes</span><span class="p">.</span><span class="n">Length</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"  </span><span class="p">{</span><span class="n">i</span><span class="p">}</span><span class="s">. </span><span class="p">{</span><span class="n">menuCafes</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Test</span>
<span class="nf">afficherCafe</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>  <span class="c1">// Fonctionne</span>
<span class="nf">afficherCafe</span><span class="p">(</span><span class="m">5</span><span class="p">);</span>  <span class="c1">// D√©clenche l'exception</span>
</code></pre></div></div>

<hr />

<h2 id="2-plusieurs-types-dexceptions--catch-multiples">2. Plusieurs types d‚Äôexceptions : <code class="language-plaintext highlighter-rouge">catch</code> multiples</h2>

<p>Un m√™me bloc <code class="language-plaintext highlighter-rouge">try</code> peut avoir plusieurs <code class="language-plaintext highlighter-rouge">catch</code> pour diff√©rents types d‚Äôerreurs.</p>

<h3 id="exemple--gestion-compl√®te-dune-commande">Exemple : Gestion compl√®te d‚Äôune commande</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">GestionCommande</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">&gt;</span> <span class="n">prix</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">double</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">2.50</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">4.00</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Latte"</span><span class="p">,</span> <span class="m">4.50</span><span class="p">}</span>
    <span class="p">};</span>
    
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">stock</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">10</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">5</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Latte"</span><span class="p">,</span> <span class="m">0</span><span class="p">}</span>
    <span class="p">};</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">PasserCommande</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">,</span> <span class="kt">string</span> <span class="n">carteCredit</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="c1">// V√©rifier que le produit existe</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">prix</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Produit '</span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">' introuvable"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// V√©rifier le stock</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">quantite</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">$"Stock insuffisant pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Simuler une erreur de carte</span>
            <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrEmpty</span><span class="p">(</span><span class="n">carteCredit</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentNullException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">carteCredit</span><span class="p">),</span> <span class="s">"Carte de cr√©dit requise"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Calculer le total</span>
            <span class="kt">double</span> <span class="n">total</span> <span class="p">=</span> <span class="n">prix</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">*</span> <span class="n">quantite</span><span class="p">;</span>
            
            <span class="c1">// Simuler le paiement</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">carteCredit</span> <span class="p">==</span> <span class="s">"CARTE_REFUSEE"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Paiement refus√© par la banque"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Commande r√©ussie</span>
            <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">-=</span> <span class="n">quantite</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ Commande r√©ussie !"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Produit : </span><span class="p">{</span><span class="n">quantite</span><span class="p">}</span><span class="s">x </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Total : </span><span class="p">{</span><span class="n">total</span><span class="p">:</span><span class="n">C2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Stock restant : </span><span class="p">{</span><span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur de produit : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Produits disponibles :"</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">p</span> <span class="k">in</span> <span class="n">prix</span><span class="p">.</span><span class="n">Keys</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"  - </span><span class="p">{</span><span class="n">p</span><span class="p">}</span><span class="s"> (</span><span class="p">{</span><span class="n">prix</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span><span class="n">C2</span><span class="p">}</span><span class="s">)"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentNullException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur de saisie : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Veuillez fournir une carte de cr√©dit valide."</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidOperationException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur d'op√©ration : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Stock"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"Stock disponible pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s"> : </span><span class="p">{</span><span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]}</span><span class="s"> unit√©s"</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="s">"Paiement"</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Veuillez essayer avec une autre carte ou payer en esp√®ces."</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur inattendue : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Veuillez contacter le support technique."</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Tests</span>
<span class="kt">var</span> <span class="n">gestion</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GestionCommande</span><span class="p">();</span>

<span class="n">gestion</span><span class="p">.</span><span class="nf">PasserCommande</span><span class="p">(</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="s">"1234-5678-9012-3456"</span><span class="p">);</span>  <span class="c1">// ‚úÖ Succ√®s</span>
<span class="n">gestion</span><span class="p">.</span><span class="nf">PasserCommande</span><span class="p">(</span><span class="s">"Mocha"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="s">"1234-5678-9012-3456"</span><span class="p">);</span>       <span class="c1">// ‚ùå Produit inexistant</span>
<span class="n">gestion</span><span class="p">.</span><span class="nf">PasserCommande</span><span class="p">(</span><span class="s">"Latte"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="s">"1234-5678-9012-3456"</span><span class="p">);</span>       <span class="c1">// ‚ùå Stock insuffisant</span>
<span class="n">gestion</span><span class="p">.</span><span class="nf">PasserCommande</span><span class="p">(</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>                     <span class="c1">// ‚ùå Carte manquante</span>
<span class="n">gestion</span><span class="p">.</span><span class="nf">PasserCommande</span><span class="p">(</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="s">"CARTE_REFUSEE"</span><span class="p">);</span>          <span class="c1">// ‚ùå Paiement refus√©</span>
</code></pre></div></div>

<hr />

<h2 id="3-le-bloc-finally--nettoyage-garanti">3. Le bloc <code class="language-plaintext highlighter-rouge">finally</code> : Nettoyage garanti</h2>

<p>Le bloc <code class="language-plaintext highlighter-rouge">finally</code> s‚Äôex√©cute toujours, qu‚Äôil y ait eu exception ou non. Parfait pour le nettoyage !</p>

<h3 id="exemple--gestion-dune-machine-√†-caf√©">Exemple : Gestion d‚Äôune machine √† caf√©</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MachineACafe</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">machineAllumee</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">bool</span> <span class="n">enPreparation</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">PreparerCafe</span><span class="p">(</span><span class="kt">string</span> <span class="n">typeCafe</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üîÑ D√©marrage de la machine..."</span><span class="p">);</span>
            <span class="n">machineAllumee</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚òï Pr√©paration du </span><span class="p">{</span><span class="n">typeCafe</span><span class="p">}</span><span class="s">..."</span><span class="p">);</span>
            <span class="n">enPreparation</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
            
            <span class="c1">// Simuler des erreurs possibles</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">typeCafe</span> <span class="p">==</span> <span class="s">"ERREUR_GRAIN"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Plus de grains de caf√© !"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">typeCafe</span> <span class="p">==</span> <span class="s">"ERREUR_EAU"</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"R√©servoir d'eau vide !"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Simulation du temps de pr√©paration</span>
            <span class="n">System</span><span class="p">.</span><span class="n">Threading</span><span class="p">.</span><span class="n">Thread</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="m">2000</span><span class="p">);</span>
            
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ </span><span class="p">{</span><span class="n">typeCafe</span><span class="p">}</span><span class="s"> pr√™t !"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidOperationException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur de pr√©paration : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Veuillez v√©rifier la machine avant de recommencer."</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">finally</span>
        <span class="p">{</span>
            <span class="c1">// Nettoyage toujours ex√©cut√©</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">enPreparation</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üßπ Nettoyage de la machine en cours..."</span><span class="p">);</span>
                <span class="n">enPreparation</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">machineAllumee</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üîå Arr√™t de la machine..."</span><span class="p">);</span>
                <span class="n">machineAllumee</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="p">}</span>
            
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"‚úÖ Machine pr√™te pour la prochaine commande.\n"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Tests</span>
<span class="kt">var</span> <span class="n">machine</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">MachineACafe</span><span class="p">();</span>

<span class="n">machine</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"Espresso"</span><span class="p">);</span>       <span class="c1">// ‚úÖ Succ√®s</span>
<span class="n">machine</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"ERREUR_GRAIN"</span><span class="p">);</span>   <span class="c1">// ‚ùå Erreur mais nettoyage</span>
<span class="n">machine</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"ERREUR_EAU"</span><span class="p">);</span>     <span class="c1">// ‚ùå Erreur mais nettoyage</span>
</code></pre></div></div>

<hr />

<h2 id="4-cr√©er-des-exceptions-personnalis√©es">4. Cr√©er des exceptions personnalis√©es</h2>

<p>Pour des erreurs sp√©cifiques √† votre application, cr√©ez vos propres exceptions.</p>

<h3 id="exemple--exceptions-m√©tier-pour-un-caf√©">Exemple : Exceptions m√©tier pour un caf√©</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Exception personnalis√©e pour stock insuffisant</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">StockInsuffisantException</span> <span class="p">:</span> <span class="n">Exception</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Produit</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">StockDisponible</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">int</span> <span class="n">QuantiteDemandee</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">StockInsuffisantException</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stockDisponible</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantiteDemandee</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="s">$"Stock insuffisant pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">. Disponible: </span><span class="p">{</span><span class="n">stockDisponible</span><span class="p">}</span><span class="s">, Demand√©: </span><span class="p">{</span><span class="n">quantiteDemandee</span><span class="p">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Produit</span> <span class="p">=</span> <span class="n">produit</span><span class="p">;</span>
        <span class="n">StockDisponible</span> <span class="p">=</span> <span class="n">stockDisponible</span><span class="p">;</span>
        <span class="n">QuantiteDemandee</span> <span class="p">=</span> <span class="n">quantiteDemandee</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Exception pour machine en panne</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">MachineEnPanneException</span> <span class="p">:</span> <span class="n">Exception</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">TypeMachine</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">CodeErreur</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">MachineEnPanneException</span><span class="p">(</span><span class="kt">string</span> <span class="n">typeMachine</span><span class="p">,</span> <span class="kt">string</span> <span class="n">codeErreur</span><span class="p">,</span> <span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">TypeMachine</span> <span class="p">=</span> <span class="n">typeMachine</span><span class="p">;</span>
        <span class="n">CodeErreur</span> <span class="p">=</span> <span class="n">codeErreur</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Exception pour client non autoris√©</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ClientNonAutoriseException</span> <span class="p">:</span> <span class="n">Exception</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">NomClient</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Raison</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>

    <span class="k">public</span> <span class="nf">ClientNonAutoriseException</span><span class="p">(</span><span class="kt">string</span> <span class="n">nomClient</span><span class="p">,</span> <span class="kt">string</span> <span class="n">raison</span><span class="p">)</span>
        <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="s">$"Client </span><span class="p">{</span><span class="n">nomClient</span><span class="p">}</span><span class="s"> non autoris√©: </span><span class="p">{</span><span class="n">raison</span><span class="p">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">NomClient</span> <span class="p">=</span> <span class="n">nomClient</span><span class="p">;</span>
        <span class="n">Raison</span> <span class="p">=</span> <span class="n">raison</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Utilisation</span>
<span class="k">class</span> <span class="nc">CafeAvecExceptionsPersonnalisees</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">stock</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">5</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">2</span><span class="p">}</span>
    <span class="p">};</span>
    
    <span class="k">private</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">clientsBannis</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashSet</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="p">{</span><span class="s">"ClientProblematique"</span><span class="p">};</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">TraiterCommande</span><span class="p">(</span><span class="kt">string</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="c1">// V√©rifier le client</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">clientsBannis</span><span class="p">.</span><span class="nf">Contains</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ClientNonAutoriseException</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="s">"Client banni pour impay√©s"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// V√©rifier le stock</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">stock</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">)</span> <span class="p">||</span> <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">quantite</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="kt">int</span> <span class="n">stockDisponible</span> <span class="p">=</span> <span class="n">stock</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">)</span> <span class="p">?</span> <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">:</span> <span class="m">0</span><span class="p">;</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">StockInsuffisantException</span><span class="p">(</span><span class="n">produit</span><span class="p">,</span> <span class="n">stockDisponible</span><span class="p">,</span> <span class="n">quantite</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Simuler une panne de machine</span>
            <span class="n">Random</span> <span class="n">random</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="c1">// 10% de chance de panne</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">MachineEnPanneException</span><span class="p">(</span><span class="s">"Broyeur"</span><span class="p">,</span> <span class="s">"ERR_001"</span><span class="p">,</span> <span class="s">"Grains coinc√©s dans le broyeur"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="c1">// Traitement r√©ussi</span>
            <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">-=</span> <span class="n">quantite</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ Commande trait√©e pour </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   </span><span class="p">{</span><span class="n">quantite</span><span class="p">}</span><span class="s">x </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Stock restant : </span><span class="p">{</span><span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ClientNonAutoriseException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"üö´ Acc√®s refus√© : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Client : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">NomClient</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Raison : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Raison</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">StockInsuffisantException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"üì¶ </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Suggestion : Commander </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">QuantiteDemandee</span> <span class="p">-</span> <span class="n">ex</span><span class="p">.</span><span class="n">StockDisponible</span><span class="p">}</span><span class="s"> unit√©s suppl√©mentaires"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">MachineEnPanneException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"üîß Panne machine : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Machine : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">TypeMachine</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Code erreur : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">CodeErreur</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Action : Contacter le technicien"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Test</span>
<span class="kt">var</span> <span class="n">cafe</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CafeAvecExceptionsPersonnalisees</span><span class="p">();</span>

<span class="n">cafe</span><span class="p">.</span><span class="nf">TraiterCommande</span><span class="p">(</span><span class="s">"Marie"</span><span class="p">,</span> <span class="s">"Espresso"</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>           <span class="c1">// ‚úÖ Possible</span>
<span class="n">cafe</span><span class="p">.</span><span class="nf">TraiterCommande</span><span class="p">(</span><span class="s">"Paul"</span><span class="p">,</span> <span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>          <span class="c1">// ‚ùå Stock insuffisant</span>
<span class="n">cafe</span><span class="p">.</span><span class="nf">TraiterCommande</span><span class="p">(</span><span class="s">"ClientProblematique"</span><span class="p">,</span> <span class="s">"Latte"</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// ‚ùå Client banni</span>
</code></pre></div></div>

<hr />

<h2 id="5-validation-et-exceptions-pr√©ventives">5. Validation et exceptions pr√©ventives</h2>

<p>Il vaut mieux valider les donn√©es avant qu‚Äôelles causent des erreurs.</p>

<h3 id="exemple--validation-robuste-de-commande">Exemple : Validation robuste de commande</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">ValidateurCommande</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">ValiderCommande</span><span class="p">(</span><span class="kt">string</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">,</span> <span class="kt">double</span> <span class="n">montant</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Validation du nom client</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Le nom du client ne peut pas √™tre vide"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">client</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">Length</span> <span class="p">&lt;</span> <span class="m">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Le nom du client doit contenir au moins 2 caract√®res"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">client</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="c1">// Validation du produit</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">produit</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Le nom du produit ne peut pas √™tre vide"</span><span class="p">,</span> <span class="k">nameof</span><span class="p">(</span><span class="n">produit</span><span class="p">));</span>
        <span class="p">}</span>
        
        <span class="c1">// Validation de la quantit√©</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">quantite</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">quantite</span><span class="p">),</span> <span class="s">"La quantit√© doit √™tre sup√©rieure √† 0"</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">quantite</span> <span class="p">&gt;</span> <span class="m">10</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">quantite</span><span class="p">),</span> <span class="s">"Maximum 10 unit√©s par commande"</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="c1">// Validation du montant</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">montant</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">montant</span><span class="p">),</span> <span class="s">"Le montant ne peut pas √™tre n√©gatif"</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">montant</span> <span class="p">&gt;</span> <span class="m">1000</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentOutOfRangeException</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">montant</span><span class="p">),</span> <span class="s">"Montant maximum : 1000‚Ç¨"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Service de commande s√©curis√©</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ServiceCommande</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">CreerCommande</span><span class="p">(</span><span class="kt">string</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">,</span> <span class="kt">double</span> <span class="n">montant</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="c1">// Validation pr√©ventive</span>
            <span class="n">ValidateurCommande</span><span class="p">.</span><span class="nf">ValiderCommande</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">produit</span><span class="p">,</span> <span class="n">quantite</span><span class="p">,</span> <span class="n">montant</span><span class="p">);</span>
            
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ Commande valid√©e :"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Client : </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Produit : </span><span class="p">{</span><span class="n">quantite</span><span class="p">}</span><span class="s">x </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Montant : </span><span class="p">{</span><span class="n">montant</span><span class="p">:</span><span class="n">C2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur de validation : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Param√®tre : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">ParamName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentOutOfRangeException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Valeur hors limites : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Param√®tre : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">ParamName</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Tests de validation</span>
<span class="kt">var</span> <span class="n">service</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ServiceCommande</span><span class="p">();</span>

<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"Marie"</span><span class="p">,</span> <span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">8.00</span><span class="p">);</span>    <span class="c1">// ‚úÖ Valide</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"Espresso"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">2.50</span><span class="p">);</span>           <span class="c1">// ‚ùå Nom vide</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"A"</span><span class="p">,</span> <span class="s">"Latte"</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">4.50</span><span class="p">);</span>             <span class="c1">// ‚ùå Nom trop court</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"Paul"</span><span class="p">,</span> <span class="s">""</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">3.00</span><span class="p">);</span>               <span class="c1">// ‚ùå Produit vide</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"Julie"</span><span class="p">,</span> <span class="s">"Americano"</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">3.00</span><span class="p">);</span>     <span class="c1">// ‚ùå Quantit√© invalide</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"Tom"</span><span class="p">,</span> <span class="s">"Mocha"</span><span class="p">,</span> <span class="m">15</span><span class="p">,</span> <span class="m">75.00</span><span class="p">);</span>         <span class="c1">// ‚ùå Trop de quantit√©</span>
<span class="n">service</span><span class="p">.</span><span class="nf">CreerCommande</span><span class="p">(</span><span class="s">"Emma"</span><span class="p">,</span> <span class="s">"Latte"</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="p">-</span><span class="m">5.00</span><span class="p">);</span>         <span class="c1">// ‚ùå Montant n√©gatif</span>
</code></pre></div></div>

<hr />

<h2 id="6-logging-et-tra√ßabilit√©-des-erreurs">6. Logging et tra√ßabilit√© des erreurs</h2>

<p>Il est important de garder une trace des erreurs pour le d√©bogage.</p>

<h3 id="exemple--syst√®me-de-logs-derreurs">Exemple : Syst√®me de logs d‚Äôerreurs</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">LoggerErreurs</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="kt">string</span> <span class="n">cheminLog</span> <span class="p">=</span> <span class="s">"erreurs_cafe.log"</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">EcrireErreur</span><span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">,</span> <span class="kt">string</span> <span class="n">contexte</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">ligneLog</span> <span class="p">=</span> <span class="s">$"[</span><span class="p">{</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">:</span><span class="n">yyyy</span><span class="p">-</span><span class="n">MM</span><span class="p">-</span><span class="n">dd</span> <span class="n">HH</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span><span class="p">}</span><span class="s">] </span><span class="p">{</span><span class="n">contexte</span><span class="p">}</span><span class="s"> - </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
        
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">File</span><span class="p">.</span><span class="nf">AppendAllText</span><span class="p">(</span><span class="n">cheminLog</span><span class="p">,</span> <span class="n">ligneLog</span> <span class="p">+</span> <span class="n">Environment</span><span class="p">.</span><span class="n">NewLine</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span>
        <span class="p">{</span>
            <span class="c1">// Si on ne peut pas √©crire dans le fichier, au moins afficher</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"ERREUR LOG: </span><span class="p">{</span><span class="n">ligneLog</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">AfficherLogs</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">Exists</span><span class="p">(</span><span class="n">cheminLog</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="kt">string</span> <span class="n">contenu</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="nf">ReadAllText</span><span class="p">(</span><span class="n">cheminLog</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üìã === HISTORIQUE DES ERREURS ==="</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">contenu</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"‚úÖ Aucune erreur enregistr√©e"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Impossible de lire le fichier de log : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">CafeAvecLogs</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">stock</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span>
    <span class="p">{</span>
        <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">3</span><span class="p">},</span>
        <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">1</span><span class="p">}</span>
    <span class="p">};</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">PreparerCafe</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">string</span> <span class="n">client</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">(!</span><span class="n">stock</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Produit </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s"> non disponible"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">$"Stock √©puis√© pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
            
            <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]--;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s"> pr√©par√© pour </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// Log de l'erreur</span>
            <span class="kt">string</span> <span class="n">contexte</span> <span class="p">=</span> <span class="s">$"Pr√©paration caf√© - Client: </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">, Produit: </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
            <span class="n">LoggerErreurs</span><span class="p">.</span><span class="nf">EcrireErreur</span><span class="p">(</span><span class="n">ex</span><span class="p">,</span> <span class="n">contexte</span><span class="p">);</span>
            
            <span class="c1">// Affichage utilisateur</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå Erreur : </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Test avec logging</span>
<span class="kt">var</span> <span class="n">cafeLog</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">CafeAvecLogs</span><span class="p">();</span>

<span class="n">cafeLog</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="s">"Marie"</span><span class="p">);</span>      <span class="c1">// ‚úÖ Succ√®s</span>
<span class="n">cafeLog</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"Latte"</span><span class="p">,</span> <span class="s">"Paul"</span><span class="p">);</span>          <span class="c1">// ‚ùå Produit inexistant (logg√©)</span>
<span class="n">cafeLog</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="s">"Julie"</span><span class="p">);</span>    <span class="c1">// ‚úÖ Succ√®s</span>
<span class="n">cafeLog</span><span class="p">.</span><span class="nf">PreparerCafe</span><span class="p">(</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="s">"Tom"</span><span class="p">);</span>      <span class="c1">// ‚ùå Stock √©puis√© (logg√©)</span>

<span class="c1">// Afficher l'historique</span>
<span class="n">LoggerErreurs</span><span class="p">.</span><span class="nf">AfficherLogs</span><span class="p">();</span>
</code></pre></div></div>

<hr />

<h2 id="7-exemple-complet--syst√®me-robuste-de-caf√©">7. Exemple complet : Syst√®me robuste de caf√©</h2>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">using</span> <span class="nn">System</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.Collections.Generic</span><span class="p">;</span>
<span class="k">using</span> <span class="nn">System.IO</span><span class="p">;</span>

<span class="c1">// Exceptions personnalis√©es</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CafeException</span> <span class="p">:</span> <span class="n">Exception</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">CafeException</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">CafeException</span><span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">,</span> <span class="n">Exception</span> <span class="n">innerException</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">innerException</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">StockEpuiseException</span> <span class="p">:</span> <span class="n">CafeException</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="kt">string</span> <span class="n">Produit</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">public</span> <span class="nf">StockEpuiseException</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="s">$"Stock √©puis√© pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Produit</span> <span class="p">=</span> <span class="n">produit</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Syst√®me robuste</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SystemeCafeRobuste</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">decimal</span><span class="p">&gt;</span> <span class="n">prix</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span> <span class="n">stock</span><span class="p">;</span>
    <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">historiqueErreurs</span><span class="p">;</span>

    <span class="k">public</span> <span class="nf">SystemeCafeRobuste</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nf">InitialiserDonnees</span><span class="p">();</span>
        <span class="n">historiqueErreurs</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">InitialiserDonnees</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">prix</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">decimal</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">2.50</span><span class="n">m</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">4.00</span><span class="n">m</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Latte"</span><span class="p">,</span> <span class="m">4.50</span><span class="n">m</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Americano"</span><span class="p">,</span> <span class="m">3.00</span><span class="n">m</span><span class="p">}</span>
        <span class="p">};</span>

        <span class="n">stock</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">int</span><span class="p">&gt;</span>
        <span class="p">{</span>
            <span class="p">{</span><span class="s">"Espresso"</span><span class="p">,</span> <span class="m">10</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">5</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Latte"</span><span class="p">,</span> <span class="m">3</span><span class="p">},</span>
            <span class="p">{</span><span class="s">"Americano"</span><span class="p">,</span> <span class="m">8</span><span class="p">}</span>
        <span class="p">};</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">ProcesserCommande</span><span class="p">(</span><span class="kt">string</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">idCommande</span> <span class="p">=</span> <span class="n">Guid</span><span class="p">.</span><span class="nf">NewGuid</span><span class="p">().</span><span class="nf">ToString</span><span class="p">()[..</span><span class="m">8</span><span class="p">];</span>
        
        <span class="k">try</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"üîÑ Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s"> - Traitement en cours..."</span><span class="p">);</span>
            
            <span class="c1">// Validations</span>
            <span class="nf">ValiderParametres</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">produit</span><span class="p">,</span> <span class="n">quantite</span><span class="p">);</span>
            <span class="nf">ValiderDisponibilite</span><span class="p">(</span><span class="n">produit</span><span class="p">,</span> <span class="n">quantite</span><span class="p">);</span>
            
            <span class="c1">// Traitement</span>
            <span class="kt">decimal</span> <span class="n">total</span> <span class="p">=</span> <span class="nf">CalculerTotal</span><span class="p">(</span><span class="n">produit</span><span class="p">,</span> <span class="n">quantite</span><span class="p">);</span>
            <span class="nf">ProcesserPaiement</span><span class="p">(</span><span class="n">total</span><span class="p">);</span>
            <span class="nf">MettreAJourStock</span><span class="p">(</span><span class="n">produit</span><span class="p">,</span> <span class="n">quantite</span><span class="p">);</span>
            
            <span class="c1">// Succ√®s</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚úÖ Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s"> termin√©e avec succ√®s !"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Client : </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Produit : </span><span class="p">{</span><span class="n">quantite</span><span class="p">}</span><span class="s">x </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   Total : </span><span class="p">{</span><span class="n">total</span><span class="p">:</span><span class="n">C2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">ArgumentException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">GererErreur</span><span class="p">(</span><span class="s">$"Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="s">"Param√®tres invalides"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">StockEpuiseException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">GererErreur</span><span class="p">(</span><span class="s">$"Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="s">"Probl√®me de stock"</span><span class="p">);</span>
            <span class="nf">ProposerAlternatives</span><span class="p">(</span><span class="n">ex</span><span class="p">.</span><span class="n">Produit</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">InvalidOperationException</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">GererErreur</span><span class="p">(</span><span class="s">$"Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="s">"Erreur de traitement"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="nf">GererErreur</span><span class="p">(</span><span class="s">$"Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s">"</span><span class="p">,</span> <span class="n">ex</span><span class="p">,</span> <span class="s">"Erreur inattendue"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">finally</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"üìù Commande </span><span class="p">{</span><span class="n">idCommande</span><span class="p">}</span><span class="s"> archiv√©e.\n"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">ValiderParametres</span><span class="p">(</span><span class="kt">string</span> <span class="n">client</span><span class="p">,</span> <span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">client</span><span class="p">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Nom client requis"</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span><span class="p">.</span><span class="nf">IsNullOrWhiteSpace</span><span class="p">(</span><span class="n">produit</span><span class="p">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Nom produit requis"</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">quantite</span> <span class="p">&lt;=</span> <span class="m">0</span> <span class="p">||</span> <span class="n">quantite</span> <span class="p">&gt;</span> <span class="m">10</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">"Quantit√© doit √™tre entre 1 et 10"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">ValiderDisponibilite</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">prix</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">))</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Produit '</span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">' non disponible au menu"</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(!</span><span class="n">stock</span><span class="p">.</span><span class="nf">ContainsKey</span><span class="p">(</span><span class="n">produit</span><span class="p">)</span> <span class="p">||</span> <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">&lt;</span> <span class="n">quantite</span><span class="p">)</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">StockEpuiseException</span><span class="p">(</span><span class="n">produit</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="kt">decimal</span> <span class="nf">CalculerTotal</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">prix</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">*</span> <span class="n">quantite</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProcesserPaiement</span><span class="p">(</span><span class="kt">decimal</span> <span class="n">montant</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Simulation d'un paiement qui peut √©chouer</span>
        <span class="n">Random</span> <span class="n">random</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Random</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">random</span><span class="p">.</span><span class="nf">Next</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">20</span><span class="p">)</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="c1">// 5% de chance d'√©chec</span>
        <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">"Erreur de paiement - Carte refus√©e"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">MettreAJourStock</span><span class="p">(</span><span class="kt">string</span> <span class="n">produit</span><span class="p">,</span> <span class="kt">int</span> <span class="n">quantite</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">stock</span><span class="p">[</span><span class="n">produit</span><span class="p">]</span> <span class="p">-=</span> <span class="n">quantite</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">GererErreur</span><span class="p">(</span><span class="kt">string</span> <span class="n">contexte</span><span class="p">,</span> <span class="n">Exception</span> <span class="n">ex</span><span class="p">,</span> <span class="kt">string</span> <span class="n">type</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">messageErreur</span> <span class="p">=</span> <span class="s">$"[</span><span class="p">{</span><span class="n">DateTime</span><span class="p">.</span><span class="n">Now</span><span class="p">:</span><span class="n">HH</span><span class="p">:</span><span class="n">mm</span><span class="p">:</span><span class="n">ss</span><span class="p">}</span><span class="s">] </span><span class="p">{</span><span class="n">contexte</span><span class="p">}</span><span class="s"> - </span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">;</span>
        <span class="n">historiqueErreurs</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">messageErreur</span><span class="p">);</span>
        
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"‚ùå </span><span class="p">{</span><span class="n">type</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        
        <span class="c1">// Log d√©taill√© pour debug</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   D√©tail technique: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="nf">GetType</span><span class="p">().</span><span class="n">Name</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">void</span> <span class="nf">ProposerAlternatives</span><span class="p">(</span><span class="kt">string</span> <span class="n">produitDemande</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üí° Alternatives disponibles :"</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">stock</span><span class="p">.</span><span class="nf">Where</span><span class="p">(</span><span class="n">s</span> <span class="p">=&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">Value</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"   - </span><span class="p">{</span><span class="n">item</span><span class="p">.</span><span class="n">Key</span><span class="p">}</span><span class="s"> (</span><span class="p">{</span><span class="n">item</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s"> disponibles) - </span><span class="p">{</span><span class="n">prix</span><span class="p">[</span><span class="n">item</span><span class="p">.</span><span class="n">Key</span><span class="p">]:</span><span class="n">C2</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">void</span> <span class="nf">AfficherStatut</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"üìä === STATUT DU SYST√àME ==="</span><span class="p">);</span>
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Stock actuel :"</span><span class="p">);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">item</span> <span class="k">in</span> <span class="n">stock</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="kt">string</span> <span class="n">statut</span> <span class="p">=</span> <span class="n">item</span><span class="p">.</span><span class="n">Value</span> <span class="p">&gt;</span> <span class="m">5</span> <span class="p">?</span> <span class="s">"‚úÖ"</span> <span class="p">:</span> <span class="n">item</span><span class="p">.</span><span class="n">Value</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">?</span> <span class="s">"‚ö†Ô∏è"</span> <span class="p">:</span> <span class="s">"‚ùå"</span><span class="p">;</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"  </span><span class="p">{</span><span class="n">statut</span><span class="p">}</span><span class="s"> </span><span class="p">{</span><span class="n">item</span><span class="p">.</span><span class="n">Key</span><span class="p">}</span><span class="s"> : </span><span class="p">{</span><span class="n">item</span><span class="p">.</span><span class="n">Value</span><span class="p">}</span><span class="s"> unit√©s"</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"\nErreurs enregistr√©es : </span><span class="p">{</span><span class="n">historiqueErreurs</span><span class="p">.</span><span class="n">Count</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">historiqueErreurs</span><span class="p">.</span><span class="n">Count</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Derni√®res erreurs :"</span><span class="p">);</span>
            <span class="k">foreach</span> <span class="p">(</span><span class="kt">string</span> <span class="n">erreur</span> <span class="k">in</span> <span class="n">historiqueErreurs</span><span class="p">.</span><span class="nf">TakeLast</span><span class="p">(</span><span class="m">3</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">$"  </span><span class="p">{</span><span class="n">erreur</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">systeme</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SystemeCafeRobuste</span><span class="p">();</span>
        
        <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"‚òï === SYST√àME DE CAF√â ROBUSTE ===\n"</span><span class="p">);</span>
        
        <span class="c1">// Tests de commandes</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">"Marie"</span><span class="p">,</span> <span class="s">"Cappuccino"</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>      <span class="c1">// ‚úÖ Normal</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="s">"Espresso"</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>             <span class="c1">// ‚ùå Client vide</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">"Paul"</span><span class="p">,</span> <span class="s">"Th√©"</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>              <span class="c1">// ‚ùå Produit inexistant</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">"Julie"</span><span class="p">,</span> <span class="s">"Latte"</span><span class="p">,</span> <span class="m">5</span><span class="p">);</span>           <span class="c1">// ‚ùå Stock insuffisant</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">"Tom"</span><span class="p">,</span> <span class="s">"Americano"</span><span class="p">,</span> <span class="m">15</span><span class="p">);</span>        <span class="c1">// ‚ùå Quantit√© trop √©lev√©e</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">ProcesserCommande</span><span class="p">(</span><span class="s">"Emma"</span><span class="p">,</span> <span class="s">"Espresso"</span><span class="p">,</span> <span class="m">2</span><span class="p">);</span>         <span class="c1">// ‚úÖ Normal</span>
        
        <span class="c1">// Statut final</span>
        <span class="n">systeme</span><span class="p">.</span><span class="nf">AfficherStatut</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="8-bonnes-pratiques-de-gestion-dexceptions">8. Bonnes pratiques de gestion d‚Äôexceptions</h2>

<h3 id="-exceptions-sp√©cifiques">‚úÖ Exceptions sp√©cifiques</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ‚úÖ Bon - Exception sp√©cifique</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">FileNotFoundException</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="s">"Fichier non trouv√©"</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// ‚ùå √âviter - Trop g√©n√©ral</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Capture tout, difficile √† d√©boguer</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="-messages-derreur-utiles">‚úÖ Messages d‚Äôerreur utiles</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ‚úÖ Message informatif</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">ArgumentException</span><span class="p">(</span><span class="s">$"Stock insuffisant pour </span><span class="p">{</span><span class="n">produit</span><span class="p">}</span><span class="s">. Disponible: </span><span class="p">{</span><span class="n">stockActuel</span><span class="p">}</span><span class="s">, Demand√©: </span><span class="p">{</span><span class="n">quantite</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>

<span class="c1">// ‚ùå Message peu utile</span>
<span class="k">throw</span> <span class="k">new</span> <span class="nf">Exception</span><span class="p">(</span><span class="s">"Erreur"</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="-logging-appropri√©">‚úÖ Logging appropri√©</h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ‚úÖ Log avec contexte</span>
<span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">ex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">LogError</span><span class="p">(</span><span class="s">$"Erreur lors de la commande </span><span class="p">{</span><span class="n">commandeId</span><span class="p">}</span><span class="s"> pour </span><span class="p">{</span><span class="n">client</span><span class="p">}</span><span class="s">: </span><span class="p">{</span><span class="n">ex</span><span class="p">.</span><span class="n">Message</span><span class="p">}</span><span class="s">"</span><span class="p">);</span>
    <span class="c1">// Puis gestion utilisateur</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="-nettoyage-avec-finally-ou-using">‚úÖ Nettoyage avec <code class="language-plaintext highlighter-rouge">finally</code> ou <code class="language-plaintext highlighter-rouge">using</code></h3>
<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ‚úÖ Avec using (automatique)</span>
<span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">connexion</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DatabaseConnection</span><span class="p">())</span>
<span class="p">{</span>
    <span class="c1">// Travail avec la connexion</span>
<span class="p">}</span> <span class="c1">// Fermeture automatique</span>

<span class="c1">// ‚úÖ Avec finally (manuel)</span>
<span class="n">FileStream</span> <span class="n">fichier</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
<span class="k">try</span>
<span class="p">{</span>
    <span class="n">fichier</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="s">"data.txt"</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">);</span>
    <span class="c1">// Travail avec le fichier</span>
<span class="p">}</span>
<span class="k">finally</span>
<span class="p">{</span>
    <span class="n">fichier</span><span class="p">?.</span><span class="nf">Close</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<hr />

<h2 id="exercices-pratiques">Exercices pratiques</h2>

<h3 id="exercice-1--calculatrice-robuste">Exercice 1 : Calculatrice robuste</h3>
<p>Cr√©ez une calculatrice qui g√®re toutes les erreurs possibles (division par z√©ro, formats invalides, etc.).</p>

<h3 id="exercice-2--lecteur-de-fichier-s√©curis√©">Exercice 2 : Lecteur de fichier s√©curis√©</h3>
<p>Cr√©ez un syst√®me qui lit des commandes depuis un fichier avec gestion compl√®te des erreurs.</p>

<h3 id="exercice-3--api-de-caf√©-resiliente">Exercice 3 : API de caf√© resiliente</h3>
<p>Cr√©ez une classe qui simule un service web avec retry automatique en cas d‚Äôerreur.</p>

<hr />

<h2 id="conclusion">Conclusion</h2>

<p>La gestion d‚Äôexceptions est l‚Äôart de <strong>transformer les probl√®mes en solutions</strong> ! Elle nous permet de :</p>

<ul>
  <li>‚úÖ <strong>Anticiper les erreurs</strong> avec des validations</li>
  <li>‚úÖ <strong>G√©rer les exceptions</strong> avec <code class="language-plaintext highlighter-rouge">try...catch...finally</code></li>
  <li>‚úÖ <strong>Cr√©er des exceptions m√©tier</strong> sp√©cifiques</li>
  <li>‚úÖ <strong>Logger et tracer</strong> pour le d√©bogage</li>
  <li>‚úÖ <strong>Offrir une exp√©rience utilisateur</strong> fluide m√™me en cas d‚Äôerreur</li>
</ul>

<p>Comme un barista exp√©riment√© qui sait g√©rer toutes les situations impr√©vues, un d√©veloppeur ma√Ætrisant les exceptions cr√©e des applications fiables et professionnelles !</p>

<p><strong>Prochaine √©tape :</strong> Nous d√©couvrirons les m√©thodes et fonctions pour organiser et r√©utiliser notre code ! ‚òï</p>

<hr />

<p><em>Pratiquez avec ces exemples et cr√©ez vos propres gestionnaires d‚Äôerreurs. Un bon code, c‚Äôest comme un bon caf√© : pr√©par√© avec soin et attention aux d√©tails ! üöÄ</em></p>

  </div><a class="u-url" href="/2025/01/30/gestion-exceptions.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Le dev, c&#39;est di√®se</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">MattDevBzh</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Veille, tutoriels .NET, Azure et plus</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
